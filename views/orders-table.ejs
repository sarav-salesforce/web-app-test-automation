<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Orders Table</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="orders-embed">
    <section class="orders-table">
      <table>
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Date</th>
            <th>Items</th>
            <th>Total</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (!orders.length) { %>
          <tr>
            <td colspan="6" class="empty">No orders yet. Place one from checkout.</td>
          </tr>
          <% } %>
          <% orders.forEach((order) => { %>
          <tr>
            <td><%= order.orderNumber %></td>
            <td><%= new Date(order.createdAt).toLocaleDateString() %></td>
            <td><%= order.items.reduce((sum, item) => sum + (item.quantity || 0), 0) %> item(s)</td>
            <td>Â£<%= Number(order.total).toFixed(2) %></td>
            <td>
              <span class="status-badge"><%= order.status %></span>
            </td>
            <td>
            <a class="btn ghost small" href="/orders/<%= order.orderNumber %>" target="_parent">
              View Details
            </a>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </section>
    <script>
      (function () {
        const sendHeight = () => {
          const height = document.body.scrollHeight;
          window.parent?.postMessage({ type: 'ordersHeight', height }, '*');
        };

        window.addEventListener('load', sendHeight);
        const resizeObserver = new ResizeObserver(sendHeight);
        resizeObserver.observe(document.body);
      })();
    </script>
  </body>
</html>
